--- app/command/metriccmd.py
+++ app/command/metriccmd.py
@@ -17,13 +17,13 @@ FACILITIES = {
 class GeneralMetricHandler:
     def process_metric(self,message_type,payload):
         lines = ""
-        for (name,tag_keys,tag_values,value_keys,data) in payload['general'].items():
+        for (name,tag_keys,tag_values,value_keys,data) in payload['general']:
             for (tag_keys_data,tag_values_data,value_keys_data,value_values) in data:
-                tags = [ (tag_keys[k],tag_values[v]) for (k,v) in zip(tag_keys,tag_values) ]
-                values = [ (value_keys[k],v) for (k,v) in zip(value_keys,value_values) ]
-                tags_str = ",".join(["{0}={1}".format(k,v) for (k,v) in tags])
+                tags = [ (tag_keys[k],tag_values[v]) for (k,v) in zip(tag_keys_data,tag_values_data) ]
+                values = [ (value_keys[k],v) for (k,v) in zip(value_keys_data,value_values) ]
+                tags_str = ",".join([name]+["{0}={1}".format(k,v) for (k,v) in tags])
                 values_str = ",".join(["{0}={1}".format(k,v) for (k,v) in values])
-                lines += "{0},{1} {2}\n".format(name,tags_str,values_str)
+                lines += "{0} {1}\n".format(tags_str,values_str)
         send_to_telegraf(lines)
 
 class DatastreamMetricHandler:
