version: "3"
services:
    backend-hi:
        build: ../../backend-server
        ports:
            - 3333:3333
        volumes:
            - ${DATA_PATH:-.}:/data
        environment:
            - MEMCACHED=memcached:11211
            - MEMCACHED_PREFIX=gb
            - THREADS=16
            - DEBUG
            - LOG_HOST
            - LOG_PORT
        networks:
            - default

    backend-lo:
        build: ../../backend-server
        ports:
            - 3334:3333
        volumes:
            - ${DATA_PATH:-.}:/data
        environment:
            - MEMCACHED=memcached:11211
            - MEMCACHED_PREFIX=gb
            - DEBUG
            - THREADS=4
            - LOG_HOST
            - LOG_PORT
        networks:
            - default

    memcached:
        build: ../../memcached-container
        ports:
            - 11211:11211
        environment:
            - MEMCACHED_MB=1024
        networks:
            - default

    nginx:
        build: ../../nginx-container
        ports:
            - 80:80
        environment:
            - UPSTREAM=ensembl-2020-gb-flatfiles.s3.eu-west-2.amazonaws.com
            - LOG_HOST
            - LOG_PORT
            - NGINX_CACHE_SIZE
            - FILE_OWNER
            - FILE_GROUP
            - NGINX_CACHE_DIR
        volumes:
            - ${NGINX_CACHE_DIR:-.}:/cache

    bump-detector:
        build: ../../bump-container
        environment:
            - MEMCACHED=memcached:11211
            - MEMCACHED_PREFIX=gb
            - LOG_HOST
            - LOG_PORT
            - BUMP_URL=http://ensembl-2020-gb-flatfiles.s3.eu-west-2.amazonaws.com/bump
        volumes:
            - ${NGINX_CACHE_DIR:-.}:/cache
